function [divI] = calc_div(Gx, Gy)

    % convert gradients for 3 RGB to gradients of their norm
    gx = zeros(size(Gx,1:2));
    gy = zeros(size(Gx,1:2));

    for i = 1:size(Gx,1)
        for j = 1:size(Gx,2)
            gx(i,j) = sqrt(sum(Gx(i,j,:).^2));
            gy(i,j) = sqrt(sum(Gy(i,j,:).^2));
        end
    end

    for i = 1:size(Gx,1)
        for j = 1:size(Gx,2)
            if j < size(Gx,2) && i < size(Gx,1)          
                div_x = gx(i,j,:) - gx(i,j+1,:);
                div_y = gy(i,j,:) - gx(i,j+1,:);
                Gy(i,j,:) = I(i,j,:) - I(i+1,j,:);
            elseif j == size(Gx,2) && i < size(Gx,1)
                %Gx(i,j,:) = [0 0 0];
                Gy(i,j,:) = I(i,j,:) - I(i+1,j,:);
            elseif i == size(Gx,1) && j < size(Gx,2)
                Gx(i,j,:) = I(i,j,:) - I(i,j+1,:);
                %Gy(i,j,:) = [0 0 0];       
            end
        end
    end
...